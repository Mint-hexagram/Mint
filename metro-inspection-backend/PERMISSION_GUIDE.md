# 权限管理指南

## 注册用户权限设置

### 当前权限体系

我们使用RBAC（基于角色的访问控制）模型来管理用户权限：

1. **角色定义**：
   - `admin`：超级管理员，拥有所有权限
   - `user`：普通用户，只能查看基本功能
   - `operator`：操作员，可以管理任务和缺陷

2. **注册用户默认权限**：
   - 新注册的用户会自动分配 `user` 角色
   - 拥有以下权限：
     - `sys:user:view`：查看用户信息
     - `sys:task:view`：查看任务信息
     - `sys:defect:view`：查看缺陷信息

### 权限初始化步骤

1. **启动应用后，调用初始化接口**：
   ```bash
   POST /api/test/init-roles
   ```
   这会创建三个默认角色：admin、user、operator

2. **创建管理员用户**：
   ```bash
   POST /api/test/create-test-user
   ```
   创建用户名：admin，密码：123456 的管理员账户

3. **注册新用户**：
   通过注册页面注册的用户会自动获得 `user` 角色

### 权限升级

如果需要提升用户权限，可以通过以下方式：

1. **通过管理员界面**（需要实现）：
   - 在用户管理页面修改用户角色
   - 支持多角色分配

2. **通过数据库直接修改**：
   ```sql
   -- 将用户升级为操作员
   INSERT INTO sys_user_role (user_id, role_id) 
   SELECT u.user_id, r.role_id 
   FROM sys_user u, sys_role r 
   WHERE u.username = '用户名' AND r.role_key = 'operator';
   ```

### 权限验证

1. **前端路由守卫**：
   - 根据用户角色显示/隐藏菜单
   - 阻止未授权页面访问

2. **后端接口权限**：
   - 使用 `@PreAuthorize` 注解控制接口访问
   - JWT令牌中包含用户角色信息

### 安全建议

1. **最小权限原则**：新注册用户只获得必要的最小权限
2. **权限审计**：定期检查用户权限分配
3. **角色继承**：避免过度复杂的权限继承关系
4. **权限缓存**：使用Redis缓存用户权限，提高性能

### 扩展说明

当前实现是基础版本，后续可以扩展：

1. **细粒度权限**：基于菜单和按钮的权限控制
2. **数据权限**：基于部门的数据访问控制
3. **动态权限**：运行时修改用户权限
4. **权限组**：批量权限管理 